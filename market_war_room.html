<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸‚å ´æˆ°æƒ…å®¤ - FinMind Antigravity</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }

    .chart-container {
      position: relative;
      height: 400px;
      margin-bottom: 30px;
    }

    .stat-card {
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .positive {
      color: #dc3545;
    }

    .negative {
      color: #198754;
    }

    .navbar-brand {
      font-weight: bold;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">ğŸ“Š å¸‚å ´æˆ°æƒ…å®¤</span>
      <span class="navbar-text text-white-50">
        <small>æ›´æ–°æ™‚é–“: <span id="updateTime">è¼‰å…¥ä¸­...</span></small>
      </span>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <!-- å¸‚å ´æ¦‚æ³çµ±è¨ˆå¡ç‰‡ -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card stat-card border-danger">
          <div class="card-body text-center">
            <h6 class="text-muted">æ¼²åœå®¶æ•¸</h6>
            <div class="display-4 fw-bold text-danger" id="limitUpCount">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card border-success">
          <div class="card-body text-center">
            <h6 class="text-muted">è·Œåœå®¶æ•¸</h6>
            <div class="display-4 fw-bold text-success" id="limitDownCount">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card border-danger">
          <div class="card-body text-center">
            <h6 class="text-muted">ä¸Šæ¼²å®¶æ•¸</h6>
            <div class="display-4 fw-bold text-danger" id="upCount">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card border-success">
          <div class="card-body text-center">
            <h6 class="text-muted">ä¸‹è·Œå®¶æ•¸</h6>
            <div class="display-4 fw-bold text-success" id="downCount">-</div>
          </div>
        </div>
      </div>
    </div>

    <!-- åœ–è¡¨å€ -->
    <div class="row">
      <!-- åŠ æ¬ŠæŒ‡æ•¸ -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-light fw-bold">
            ğŸ“ˆ å°è‚¡åŠ æ¬ŠæŒ‡æ•¸ï¼ˆè¿‘ 120 æ—¥ï¼‰
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="taiexChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- é¨°è½ç·š -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-light fw-bold">
            ğŸ“Š é¨°è½ç·šï¼ˆADLï¼‰
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="adlChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç”¢æ¥­è³‡é‡‘æµå‘ -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-light fw-bold">
            ğŸ’° ç”¢æ¥­è³‡é‡‘æµå‘ï¼ˆå‰ 10 å¤§ï¼‰
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>æ’å</th>
                    <th>ç”¢æ¥­é¡åˆ¥</th>
                    <th class="text-end">è³‡é‡‘æµå‘ï¼ˆå„„ï¼‰</th>
                    <th class="text-end">è¼ƒå‰æ—¥è®ŠåŒ–</th>
                  </tr>
                </thead>
                <tbody id="sectorTable">
                  <tr>
                    <td colspan="4" class="text-center text-muted">è¼‰å…¥ä¸­...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¿”å›é¦–é æŒ‰éˆ• -->
    <div class="row mt-4 mb-4">
      <div class="col-12 text-center">
        <a href="index.html" class="btn btn-primary btn-lg">
          ğŸ  è¿”å›é¦–é 
        </a>
      </div>
    </div>
  </div>

  <script>
    // é¡¯ç¤ºç•¶å‰æ™‚é–“
    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleString('zh-TW', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      document.getElementById('updateTime').textContent = timeStr;
    }

    updateTime();
    setInterval(updateTime, 1000);

    // è¼‰å…¥è³‡æ–™ä¸¦ç¹ªè£½åœ–è¡¨
    async function loadData() {
      try {
        const response = await fetch('data/market_war_room.json');
        if (!response.ok) {
          // å¦‚æœ JSON ä¸å­˜åœ¨ï¼Œä½¿ç”¨ Playground çš„è³‡æ–™
          const fallbackResponse = await fetch('../Playground/dashboard_data.json');
          const data = await fallbackResponse.json();
          renderCharts(data);
          return;
        }
        const data = await response.json();
        renderCharts(data);
      } catch (error) {
        console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
        document.getElementById('sectorTable').innerHTML =
          '<tr><td colspan="4" class="text-center text-danger">è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>';
      }
    }

    function renderCharts(data) {
      // æ›´æ–°çµ±è¨ˆå¡ç‰‡
      if (data.breadth && data.breadth.length > 0) {
        const latest = data.breadth[data.breadth.length - 1];
        document.getElementById('limitUpCount').textContent = latest.limit_up || 0;
        document.getElementById('limitDownCount').textContent = latest.limit_down || 0;
        document.getElementById('upCount').textContent = latest.up || 0;
        document.getElementById('downCount').textContent = latest.down || 0;
      }

      // ç¹ªè£½åŠ æ¬ŠæŒ‡æ•¸åœ–è¡¨
      const taiexDates = data.taiex.map(d => d.date);
      const taiexClose = data.taiex.map(d => d.close);

      new Chart(document.getElementById('taiexChart'), {
        type: 'line',
        data: {
          labels: taiexDates,
          datasets: [{
            label: 'æ”¶ç›¤åƒ¹',
            data: taiexClose,
            borderColor: 'rgb(220, 53, 69)',
            backgroundColor: 'rgba(220, 53, 69, 0.1)',
            tension: 0.1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              ticks: {
                maxTicksLimit: 10
              }
            }
          }
        }
      });

      // ç¹ªè£½é¨°è½ç·šåœ–è¡¨
      const adlDates = data.breadth.map(d => d.date);
      const adlValues = data.breadth.map(d => d.adl);

      new Chart(document.getElementById('adlChart'), {
        type: 'line',
        data: {
          labels: adlDates,
          datasets: [{
            label: 'é¨°è½ç·š',
            data: adlValues,
            borderColor: 'rgb(13, 110, 253)',
            backgroundColor: 'rgba(13, 110, 253, 0.1)',
            tension: 0.1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              ticks: {
                maxTicksLimit: 10
              }
            }
          }
        }
      });

      // æ›´æ–°ç”¢æ¥­è³‡é‡‘æµå‘è¡¨æ ¼
      const sectorTable = document.getElementById('sectorTable');
      if (data.sectors && data.sectors.length > 0) {
        sectorTable.innerHTML = data.sectors.map((sector, index) => {
          const flowBillion = (sector.flow / 100000000).toFixed(2);
          const flowClass = sector.flow > 0 ? 'positive' : 'negative';
          const diffClass = sector.diff_pct > 0 ? 'positive' : 'negative';
          const diffIcon = sector.diff_pct > 0 ? 'â–²' : 'â–¼';

          return `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${sector.industry_category}</td>
                            <td class="text-end font-monospace ${flowClass}">${flowBillion}</td>
                            <td class="text-end font-monospace ${diffClass}">
                                ${diffIcon} ${Math.abs(sector.diff_pct).toFixed(2)}%
                            </td>
                        </tr>
                    `;
        }).join('');
      } else {
        sectorTable.innerHTML = '<tr><td colspan="4" class="text-center text-muted">ç„¡è³‡æ–™</td></tr>';
      }
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
    loadData();
  </script>
</body>

</html>