<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinMind ÂãïÊÖãÁ≠ñÁï•ÁØ©ÈÅ∏Âô®</title>
    <!-- Vue.js 3 (CDN for simplicity) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS (CDN for styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Market Data (Local JS file to bypass CORS) -->
    <script src="../Data/market_metrics_latest.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.5s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body>
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-full mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">‚ö°</span>
                    <h1 class="text-xl font-bold text-gray-800">FinMind ÂãïÊÖãÁ≠ñÁï•ÁØ©ÈÅ∏Âô® <span
                            class="text-xs text-gray-500 font-normal ml-2">v1.0 (Phase 1)</span></h1>
                </div>
                <!-- Loading State -->
                <div v-if="loading" class="text-blue-600 font-semibold flex items-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    ËºâÂÖ•‰∏≠...
                </div>
                <div v-else class="text-sm text-gray-500">
                    Ë≥áÊñô‰æÜÊ∫ê: {{ lastUpdated }} | ÂÖ± {{ filteredCount }} / {{ totalCount }} Ê™î
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow p-6">
            <div class="max-w-full mx-auto grid grid-cols-1 lg:grid-cols-5 gap-6">

                <!-- Filters Panel (Sidebar) -->
                <div class="lg:col-span-1 bg-white rounded-xl shadow-sm p-6 h-fit sticky top-24">
                    <h2 class="text-lg font-bold mb-4 text-gray-700 border-b pb-2">üîç ÁØ©ÈÅ∏Ê¢ù‰ª∂</h2>

                    <!-- Price Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">ËÇ°ÂÉπÁØÑÂúç (ÂÖÉ)</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" v-model.number="filters.minPrice" placeholder="Min"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                            <span class="text-gray-400">~</span>
                            <input type="number" v-model.number="filters.maxPrice" placeholder="Max"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                        </div>
                    </div>

                    <!-- Yield Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2 flex justify-between items-center">
                            <span>ÊÆñÂà©Áéá > {{ filters.minYield }}%</span>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="filters.strictYield" class="sr-only peer">
                                <div
                                    class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                </div>
                                <span class="ms-2 text-xs font-medium text-gray-500"
                                    :class="{'text-blue-600 font-bold': filters.strictYield}">Âö¥Ê†º</span>
                            </label>
                        </label>
                        <input type="range" v-model.number="filters.minYield" min="0" max="10" step="0.5"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span v-if="filters.strictYield" class="text-blue-500">ÊØèÂπ¥ > {{ filters.minYield }}%</span>
                            <span v-else>Âπ≥Âùá > {{ filters.minYield }}%</span>
                        </div>
                    </div>

                    <!-- Fill Days Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2 flex justify-between items-center">
                            <span>Â°´ÊÅØÂ§©Êï∏ < {{ filters.maxFillDays }} Â§©</span>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" v-model="filters.strictFill" class="sr-only peer">
                                        <div
                                            class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                        </div>
                                        <span class="ms-2 text-xs font-medium text-gray-500"
                                            :class="{'text-blue-600 font-bold': filters.strictFill}">Âö¥Ê†º</span>
                                    </label>
                        </label>
                        <input type="range" v-model.number="filters.maxFillDays" min="0" max="365" step="5"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span v-if="filters.strictFill" class="text-blue-500">
                                {{ filters.maxFillDays >= 365 ? 'ÊØèÂπ¥‰∏çÈôêÂ§©Êï∏' : 'ÊØèÂπ¥ < ' + filters.maxFillDays + ' Â§©' }}
                                    </span>
                                    <span v-else>
                                        {{ filters.maxFillDays >= 365 ? 'Âπ≥Âùá‰∏çÈôêÂ§©Êï∏' : 'Âπ≥Âùá < ' + filters.maxFillDays + ' Â§©'
                                            }} </span>
                        </div>
                    </div>

                    <!-- Cash Dividend Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2 flex justify-between items-center">
                            <span>ÁèæÈáëËÇ°Âà© > {{ filters.minDiv }}ÂÖÉ</span>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="filters.strictDiv" class="sr-only peer">
                                <div
                                    class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                </div>
                                <span class="ms-2 text-xs font-medium text-gray-500"
                                    :class="{'text-blue-600 font-bold': filters.strictDiv}">Âö¥Ê†º</span>
                            </label>
                        </label>
                        <input type="range" v-model.number="filters.minDiv" min="0" max="100" step="0.5"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span v-if="filters.strictDiv" class="text-blue-500">5Âπ¥ÁöÜ > {{ filters.minDiv }}ÂÖÉ</span>
                            <span v-else>ÊúÄÊñ∞ > {{ filters.minDiv }}ÂÖÉ</span>
                        </div>
                    </div>

                    <!-- Consecutive Dividend -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">ÈÄ£Á∫åÈÖçÊÅØ > {{ filters.minConsDiv }}
                            Âπ¥</label>
                        <input type="range" v-model.number="filters.minConsDiv" min="0" max="10" step="1"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <!-- Listing Years -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">‰∏äÂ∏ÇÂπ¥Êï∏ > {{ filters.minListingYears
                            }} Âπ¥</label>
                        <input type="range" v-model.number="filters.minListingYears" min="0" max="20" step="1"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>



                    <!-- Consecutive Profit -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">ÈÄ£Á∫åÁç≤Âà© > {{ filters.minConsProfit }}
                            Âπ¥</label>
                        <input type="range" v-model.number="filters.minConsProfit" min="0" max="10" step="1"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <!-- ROA Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2 flex justify-between items-center">
                            <span>ROA > {{ filters.minROA }}%</span>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="filters.strictROA" class="sr-only peer">
                                <div
                                    class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                </div>
                                <span class="ms-2 text-xs font-medium text-gray-500"
                                    :class="{'text-blue-600 font-bold': filters.strictROA}">Âö¥Ê†º</span>
                            </label>
                        </label>
                        <input type="range" v-model.number="filters.minROA" min="0" max="15" step="0.5"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span v-if="filters.strictROA" class="text-blue-500">ÊØèÂπ¥ > {{ filters.minROA }}%</span>
                            <span v-else>Âπ≥Âùá > {{ filters.minROA }}%</span>
                        </div>
                    </div>

                    <!-- Core Ratio Filter (Range) -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2 flex justify-between items-center">
                            <span>Êú¨Ê•≠ÊØîÁØÑÂúç</span>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="filters.strictCore" class="sr-only peer">
                                <div
                                    class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                </div>
                                <span class="ms-2 text-xs font-medium text-gray-500"
                                    :class="{'text-blue-600 font-bold': filters.strictCore}">Âö¥Ê†º</span>
                            </label>
                        </label>

                        <!-- Min Core -->
                        <div class="mb-2">
                            <div class="flex justify-between text-xs text-gray-500 mb-1">
                                <span>ÊúÄÂ∞èÂÄº: {{ filters.minCore }}%</span>
                            </div>
                            <input type="range" v-model.number="filters.minCore" min="0" max="100" step="5"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <!-- Max Core -->
                        <div>
                            <div class="flex justify-between text-xs text-gray-500 mb-1">
                                <span>ÊúÄÂ§ßÂÄº: {{ filters.maxCore }}%</span>
                            </div>
                            <input type="range" v-model.number="filters.maxCore" min="0" max="200" step="10"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span v-if="filters.strictCore" class="text-blue-500">ÊØèÂπ¥‰ªãÊñº {{ filters.minCore }}% ~ {{
                                filters.maxCore }}%</span>
                            <span v-else>Âπ≥Âùá‰ªãÊñº {{ filters.minCore }}% ~ {{ filters.maxCore }}%</span>
                        </div>
                    </div>

                    <!-- Div Freq Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">ÈÖçÊÅØÈ†ªÁéá</label>
                        <select v-model="filters.divFreq"
                            class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="all">ÂÖ®ÈÉ®</option>
                            <option value="Â≠£ÈÖç">Â≠£ÈÖç</option>
                            <option value="ÂçäÂπ¥ÈÖç">ÂçäÂπ¥ÈÖç</option>
                            <option value="Âπ¥ÈÖç">Âπ¥ÈÖç</option>
                        </select>
                    </div>

                    <!-- Industry Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-600 mb-2">Áî¢Ê•≠È°ûÂà•</label>
                        <select v-model="filters.industry"
                            class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="all">ÂÖ®ÈÉ®Áî¢Ê•≠</option>
                            <option v-for="ind in uniqueIndustries" :key="ind" :value="ind">{{ ind }}</option>
                        </select>
                    </div>

                    <!-- Reset Button -->
                    <button @click="resetFilters"
                        class="w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg font-medium transition-colors">
                        ÈáçÁΩÆÊ¢ù‰ª∂
                    </button>

                    <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <h3 class="text-sm font-bold text-blue-800 mb-1">üí° Â∞èÊíáÊ≠•</h3>
                        <p class="text-xs text-blue-600">
                            ÂêåÊôÇË®≠ÂÆö„ÄåÊÆñÂà©Áéá > 5%„Äç‰∏î„ÄåÂ°´ÊÅØ < 30Â§©„ÄçÂèØ‰ª•ÊâæÂá∫ÁúüÊ≠£ÁöÑÂÆöÂ≠òÂ•ΩËÇ°ÂñîÔºÅ </p>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="lg:col-span-4 bg-white rounded-xl shadow-sm overflow-hidden flex flex-col">
                    <!-- Table Header Controls -->
                    <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                        <div class="flex items-center space-x-2">
                            <input type="text" v-model="filters.search" placeholder="ÊêúÂ∞ã‰ª£ËôüÊàñÂêçÁ®±..."
                                class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm w-64">
                        </div>
                        <div class="text-sm text-gray-500">
                            ÊéíÂ∫è‰æùÊìö: <span class="font-semibold text-gray-700">{{ sortLabel }}</span>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto flex-grow relative">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 text-xs uppercase tracking-wide">
                                    <th @click="setSort('id')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors">
                                        ‰ª£Ëôü
                                    </th>
                                    <th @click="setSort('name')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors">
                                        ÂêçÁ®±
                                    </th>
                                    <th @click="setSort('industry')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors">
                                        Áî¢Ê•≠
                                    </th>
                                    <th @click="setSort('price')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ËÇ°ÂÉπ</th>
                                    <th @click="setSort('hy_yield_avg_5y')" <th @click="setSort('hy_yield_avg_5y')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right bg-blue-50">
                                        ÊÆñÂà©Áéá(5y)</th>
                                    <th @click="setSort('latest_div')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right bg-blue-50">
                                        ËÇ°Âà©($)</th>
                                    <th @click="setSort('est_yield')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right bg-blue-100 group relative">
                                        È†ê‰º∞ÊÆñÂà©Áéá
                                        <span
                                            class="invisible group-hover:visible absolute bottom-full left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-xs rounded shadow-lg whitespace-nowrap mb-1 z-10">
                                            Âü∫ÊñºÊúÄÊñ∞‰∏ÄÊúüËÇ°Âà©Êé®ÁÆó (ÊúÄÊñ∞ËÇ°ÊÅØ x È†ªÁéá / ËÇ°ÂÉπ)
                                        </span>
                                    </th>
                                    <th @click="setSort('hy_fill_days_avg')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right bg-green-50">
                                        Â°´ÊÅØÂ§©Êï∏</th>
                                    <th @click="setSort('cons_div_years')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ÈÄ£ÈÖç</th>

                                    <!-- New Columns -->
                                    <th @click="setSort('listing_years')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ‰∏äÂ∏ÇÂπ¥</th>

                                    <th @click="setSort('consecutive_profit_years')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ÈÄ£Âà©</th>
                                    <th @click="setSort('roa_avg_5y')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ROA</th>
                                    <th @click="setSort('core_ratio_avg_5y')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        Êú¨Ê•≠ÊØî</th>

                                    <th class="p-4 font-semibold text-center">È†ªÁéá</th>
                                    <th @click="setSort('rev_yoy')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ÁáüÊî∂ YoY</th>
                                    <th @click="setSort('rev_mom')"
                                        class="p-4 font-semibold cursor-pointer hover:bg-gray-200 transition-colors text-right">
                                        ÁáüÊî∂ MoM</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr v-for="stock in sortedStocks" :key="stock.id"
                                    class="hover:bg-gray-50 transition-colors group">
                                    <td class="p-4 font-medium text-blue-600">
                                        <a :href="'https://www.cmoney.tw/finance/f00025.aspx?s=' + stock.id"
                                            target="_blank" class="hover:underline">{{ stock.id }}</a>
                                    </td>
                                    <td class="p-4 font-semibold text-gray-800">{{ stock.name }}</td>
                                    <td class="p-4 text-gray-500 text-sm">{{ stock.industry }}</td>
                                    <td class="p-4 text-right font-mono text-gray-700">{{ stock.price }}</td>

                                    <!-- Yield -->
                                    <td class="p-4 text-right font-mono font-bold bg-blue-50/30 group-hover:bg-blue-50 transition-colors"
                                        :class="{'text-red-600': stock.hy_yield_avg_5y >= 5}">
                                        {{ stock.hy_yield_avg_5y }}%
                                    </td>
                                    <td
                                        class="p-4 text-right font-mono font-bold bg-blue-50/30 group-hover:bg-blue-50 transition-colors">
                                        {{ stock.latest_div }}
                                    </td>
                                    <td class="p-4 text-right font-mono font-bold bg-blue-100/30 group-hover:bg-blue-100 transition-colors cursor-help"
                                        :class="{'text-red-600': stock.est_yield >= 5}"
                                        :title="`ÊúÄÊñ∞ËÇ°Âà©: ${stock.latest_div} \nÈ†ªÁéá: ${stock.hy_div_freq} \nËÇ°ÂÉπ: ${stock.price} \nÊé®ÁÆó: (${stock.latest_div} x ${stock.hy_div_freq === 'Â≠£ÈÖç' ? 4 : (stock.hy_div_freq === 'ÂçäÂπ¥ÈÖç' ? 2 : 1)}) / ${stock.price} = ${stock.est_yield}%`">
                                        {{ stock.est_yield }}%
                                    </td>

                                    <!-- Fill Days -->
                                    <td class="p-4 text-right font-mono bg-green-50/30 group-hover:bg-green-50 transition-colors"
                                        :class="{'text-green-600 font-bold': stock.hy_fill_days_avg <= 30}">
                                        {{ stock.hy_fill_days_avg == 999 ? 'Êú™Â°´ÊÅØ' : stock.hy_fill_days_avg }}
                                    </td>
                                    <td class="p-4 text-right font-mono text-gray-600">{{ stock.cons_div_years }}
                                    </td>

                                    <!-- New Data Columns -->
                                    <td class="p-4 text-right font-mono text-gray-600">{{ stock.listing_years }}
                                    </td>

                                    <td class="p-4 text-right font-mono text-gray-600">{{
                                        stock.consecutive_profit_years
                                        }}</td>
                                    <td class="p-4 text-right font-mono"
                                        :class="{'text-red-500 font-bold': stock.roa_avg_5y >= 5}">{{
                                        stock.roa_avg_5y
                                        }}%</td>
                                    <td class="p-4 text-right font-mono text-gray-600">{{ stock.core_ratio_avg_5y
                                        }}%
                                    </td>

                                    <td class="p-4 text-center">
                                        <span class="px-2 py-1 text-xs rounded-full border" :class="{
                                                  'bg-purple-100 text-purple-700 border-purple-200': stock.hy_div_freq === 'Â≠£ÈÖç',
                                                  'bg-indigo-100 text-indigo-700 border-indigo-200': stock.hy_div_freq === 'ÂçäÂπ¥ÈÖç',
                                                  'bg-gray-100 text-gray-600 border-gray-200': stock.hy_div_freq === 'Âπ¥ÈÖç'
                                              }">
                                            {{ stock.hy_div_freq }}
                                        </span>
                                    </td>

                                    <!-- Revenue -->
                                    <td class="p-4 text-right font-mono text-sm" :class="getColorClass(stock.rev_yoy)">
                                        {{ formatNumber(stock.rev_yoy) }}%
                                    </td>
                                    <td class="p-4 text-right font-mono text-sm" :class="getColorClass(stock.rev_mom)">
                                        {{ formatNumber(stock.rev_mom) }}%
                                    </td>
                                </tr>
                                <tr v-if="sortedStocks.length === 0 && !loading"
                                    class="text-center py-12 text-gray-400">
                                    <td colspan="16" class="p-12">
                                        Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑËÇ°Á•® üê¢
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const stocks = ref([]);
                const loading = ref(true);
                const lastUpdated = ref('Êõ¥Êñ∞‰∏≠...');

                // Filters
                const filters = ref({
                    minPrice: null,
                    maxPrice: null,
                    minYield: 4,
                    strictYield: false,
                    minDiv: 0,
                    strictDiv: false,
                    maxFillDays: 60,
                    strictFill: false,
                    minListingYears: 0,
                    minConsDiv: 0,
                    minConsProfit: 0,
                    minROA: 0,
                    strictROA: false,
                    minCore: 0,
                    maxCore: 200,
                    strictCore: false,
                    divFreq: 'all',
                    industry: 'all',
                    search: ''
                });

                // Sorting
                const sortKey = ref('hy_yield_avg_5y');
                const sortDesc = ref(true);

                // Load Data
                const loadData = async () => {
                    try {
                        // Use global variable injected by market_metrics_latest.js
                        if (window.MARKET_DATA) {
                            stocks.value = window.MARKET_DATA;
                            lastUpdated.value = new Date().toLocaleDateString();
                        } else {
                            throw new Error('Data not found in window.MARKET_DATA');
                        }
                    } catch (error) {
                        console.error("Error loading Data:", error);
                        alert("ÁÑ°Ê≥ïËÆÄÂèñË≥áÊñô„ÄÇË´ãÁ¢∫Ë™çÊòØÂê¶Â∑≤Âü∑Ë°å 003_È´òÊÆñÂà©Áéá.bat Áî¢Áîü market_metrics_latest.js");
                    } finally {
                        loading.value = false;
                    }
                };

                onMounted(() => {
                    loadData();
                });

                // Computed
                const uniqueIndustries = computed(() => {
                    const industries = new Set(stocks.value.map(s => s.industry));
                    return Array.from(industries).sort();
                });

                const filteredStocks = computed(() => {
                    return stocks.value.filter(s => {
                        // Price Filter
                        if (filters.value.minPrice && s.price < filters.value.minPrice) return false;
                        if (filters.value.maxPrice && s.price > filters.value.maxPrice) return false;

                        // Yield Logic
                        const yieldVal = filters.value.strictYield ? s.hy_yield_min_5y : s.hy_yield_avg_5y;
                        if (yieldVal < filters.value.minYield) return false;

                        // Div Amount Logic
                        const divVal = filters.value.strictDiv ? s.hy_div_min_5y : s.latest_div;
                        if (divVal < filters.value.minDiv) return false;

                        // Fill Days Logic
                        // If maxFillDays is 365+, treat as unlimited (show all, including 999)
                        const fillVal = filters.value.strictFill ? s.hy_fill_days_max : s.hy_fill_days_avg;
                        if (filters.value.maxFillDays < 365 && fillVal > filters.value.maxFillDays) return false;

                        // Listing Years
                        if (s.listing_years < filters.value.minListingYears) return false;

                        // Consecutive Dividend
                        if (s.cons_div_years < filters.value.minConsDiv) return false;

                        // Consecutive Profit
                        if (s.consecutive_profit_years < filters.value.minConsProfit) return false;

                        // ROA Logic
                        const roaVal = filters.value.strictROA ? s.roa_min_5y : s.roa_avg_5y;
                        if (filters.value.minROA > 0 && roaVal < filters.value.minROA) return false;

                        // Core Ratio Logic (Range)
                        // Allow filtering, but if at boundaries, we might want lax logic?
                        // Current range: 0 ~ 200
                        const coreVal = filters.value.strictCore ? s.core_ratio_min_5y : s.core_ratio_avg_5y;
                        if (filters.value.minCore > 0 && coreVal < filters.value.minCore) return false;
                        // If maxCore is at UI max (200), treat as no upper limit
                        if (filters.value.maxCore < 200 && coreVal > filters.value.maxCore) return false;

                        // Div Freq
                        if (filters.value.divFreq !== 'all' && s.hy_div_freq !== filters.value.divFreq) return false;

                        // Industry
                        if (filters.value.industry !== 'all' && s.industry !== filters.value.industry) return false;

                        // Search
                        if (filters.value.search) {
                            const term = filters.value.search.toLowerCase();
                            return s.id.includes(term) || s.name.toLowerCase().includes(term);
                        }

                        return true;
                    });
                });

                const sortedStocks = computed(() => {
                    return [...filteredStocks.value].sort((a, b) => {
                        let va = a[sortKey.value];
                        let vb = b[sortKey.value];

                        // Handle N/A or nulls
                        if (va == null || va === "N/A" || va === 999) va = sortDesc.value ? -Infinity : Infinity;
                        if (vb == null || vb === "N/A" || vb === 999) vb = sortDesc.value ? -Infinity : Infinity;

                        if (va < vb) return sortDesc.value ? 1 : -1;
                        if (va > vb) return sortDesc.value ? -1 : 1;
                        return 0;
                    });
                });

                // Methods
                const setSort = (key) => {
                    if (sortKey.value === key) {
                        sortDesc.value = !sortDesc.value;
                    } else {
                        sortKey.value = key;
                        sortDesc.value = true; // Default desc for new numeric cols usually better
                        if (key === 'id' || key === 'industry') sortDesc.value = false;
                    }
                };

                const resetFilters = () => {
                    filters.value.minPrice = null;
                    filters.value.maxPrice = null;
                    filters.value.minYield = 0;
                    filters.value.strictYield = false;
                    filters.value.minDiv = 0;
                    filters.value.strictDiv = false;
                    filters.value.maxFillDays = 365;
                    filters.value.strictFill = false;
                    filters.value.minListingYears = 0;
                    filters.value.minConsDiv = 0;
                    filters.value.minConsProfit = 0;
                    filters.value.minROA = 0;
                    filters.value.strictROA = false;
                    filters.value.minCore = 0;
                    filters.value.maxCore = 200;
                    filters.value.strictCore = false;
                    filters.value.divFreq = 'all';
                    filters.value.industry = 'all';
                    filters.value.search = '';
                };

                const getColorClass = (val) => {
                    if (val == null) return 'text-gray-400';
                    if (val > 0) return 'text-red-600 font-bold';
                    if (val < 0) return 'text-green-600 font-bold';
                    return 'text-gray-600';
                };

                const formatNumber = (val) => {
                    if (val == null) return '-';
                    return val;
                }

                const sortLabel = computed(() => {
                    const labels = {
                        'id': '‰ª£Ëôü',
                        'name': 'ÂêçÁ®±',
                        'industry': 'Áî¢Ê•≠',
                        'price': 'ËÇ°ÂÉπ',
                        'hy_yield_avg_5y': 'ÊÆñÂà©Áéá',
                        'latest_div': 'ËÇ°Âà©',
                        'hy_fill_days_avg': 'Â°´ÊÅØÂ§©Êï∏',
                        'listing_years': '‰∏äÂ∏ÇÂπ¥',
                        'cons_div_years': 'ÈÄ£ÈÖç',
                        'consecutive_profit_years': 'ÈÄ£Âà©',
                        'roa_avg_5y': 'ROA',
                        'core_ratio_avg_5y': 'Êú¨Ê•≠ÊØî',
                        'rev_yoy': 'ÁáüÊî∂ YoY',
                        'rev_mom': 'ÁáüÊî∂ MoM'
                    };
                    return (labels[sortKey.value] || sortKey.value) + (sortDesc.value ? ' (‚Üì)' : ' (‚Üë)');
                });

                return {
                    loading,
                    stocks,
                    lastUpdated,
                    filters,
                    sortedStocks,
                    uniqueIndustries,

                    // Counts
                    totalCount: computed(() => stocks.value.length),
                    filteredCount: computed(() => filteredStocks.value.length),

                    // Methods
                    setSort,
                    resetFilters,
                    getColorClass,
                    formatNumber,
                    sortLabel
                };
            }
        }).mount('#app');
    </script>
</body>

</html>